# دليل تثبيت واستخدام WiseFlow

**يجب على مستخدمي الإصدار 3.x حذف مستودع الكود الأصلي ومجلد pb بالكامل وإعادة استنساخ مستودع الإصدار 4.x، وإلا فلن يتمكن من البدء بشكل طبيعي.**

**مستخدمو الإصدار 4.0 الذين يريدون الترقية إلى الإصدار 4.1، بعد سحب أحدث كود، يجب تنفيذ أمر ./pb/pocketbase migrate أولاً، وإلا فلن يتمكن من البدء بشكل طبيعي.**

## 📋 متطلبات النظام

- **Python**: 3.10 - 3.12 (يوصى بـ 3.12)
- **نظام التشغيل**: macOS أو Linux أو Windows
- **متطلبات الأجهزة**: 8 جيجابايت من ذاكرة الوصول العشوائي أو أكثر (عند استخدام خدمات LLM عبر الإنترنت)

## 📥 تعليمات الاستخدام

واجهة مستخدم WiseFlow 4.x تستخدم PocketBase (على الرغم من أنها ليست مثالية، لكنها الحل الأمثل حالياً)

### 1. الوصول إلى الواجهة

🌐 بعد بدء التشغيل بنجاح، افتح متصفحك وقم بزيارة: **http://127.0.0.1:8090/_/**

### 2. تكوين مصادر المعلومات ونقاط التركيز

التبديل إلى نموذج focus_point

من خلال هذا النموذج، يمكنك تحديد نقاط التركيز الخاصة بك. سيقوم LLM بتنقية وتصفية وتصنيف المعلومات وفقاً لذلك.

وصف الحقول:
- focuspoint (مطلوب): وصف نقطة التركيز، إخبار LLM بالمعلومات التي تريدها، مثل "معلومات المدارس الابتدائية والإعدادية في شنغهاي" أو "إشعارات المناقصات"
- restrictions (اختياري): قيود تصفية نقطة التركيز، إخبار LLM بالمعلومات التي يجب استبعادها، مثل "فقط معلومات القبول في المدارس الإعدادية الرسمية في شنغهاي" أو "المنشور بعد 1 يناير 2025 وبقيمة تزيد عن مليون"
- explanation (اختياري): شرح للمفاهيم الخاصة أو المصطلحات التقنية لتجنب سوء فهم LLM، مثل "المدارس الابتدائية والإعدادية تشير إلى الانتقال من المدرسة الابتدائية إلى المدرسة الإعدادية"
- activated: ما إذا كان سيتم تفعيله. إذا تم إيقاف التشغيل، سيتم تجاهل نقطة التركيز هذه، ويمكن تشغيلها مرة أخرى لاحقاً
- freq: تكرار الزحف بالساعات، نوع صحيح (نوصي بعدم تجاوز مرة واحدة في اليوم، أي تعيين 24، الحد الأدنى هو 2، أي الزحف كل ساعتين)
- search: تكوين مصادر البحث التفصيلية، حالياً يدعم bing وgithub وarxiv وebay
- sources: اختيار مصادر المعلومات المقابلة

#### 💡 طريقة كتابة نقطة التركيز مهمة جدًا، لأنها تحدد بشكل مباشر ما إذا كان استخراج المعلومات يمكن أن يلبي متطلباتك. على وجه التحديد:

  - إذا كانت حالة الاستخدام الخاصة بك هي تتبع معلومات الصناعة، والمعلومات الأكاديمية، ومعلومات السياسة، وما إلى ذلك، وتضمنت مصادر معلوماتك عمليات بحث واسعة، فيجب أن تستخدم نقطة التركيز نموذجًا للكلمات الرئيسية مشابهًا لمحرك البحث. في الوقت نفسه، يجب عليك إضافة قيود وتوضيحات، وإذا لزم الأمر، تحديد الأدوار والأهداف.

  - إذا كانت حالة الاستخدام الخاصة بك هي تتبع المنافسين، والتحقق من الخلفية، وما إلى ذلك، حيث تكون مصادر المعلومات محددة جدًا، مثل الصفحات الرئيسية للمنافسين، والحسابات الرسمية، وما إلى ذلك، فأنت تحتاج فقط إلى إدخال منظور اهتمامك كنقطة تركيز، مثل "معلومات خفض الأسعار"، "معلومات المنتج الجديد"، وما إلى ذلك.

**تعديلات تكوين نقطة التركيز ستصبح سارية المفعول تلقائياً في التنفيذ التالي دون الحاجة إلى إعادة تشغيل البرنامج.**

يمكنك إضافة مصادر المعلومات في صفحة sources أو صفحة ربط focus_points. وصف حقول إضافة مصدر المعلومات:

- type: النوع، يدعم حالياً: web، rss، wb (ويبو)، ks (كوايشو)، mp (حساب ويشات الرسمي (غير مدعوم مؤقتاً في 4.0، في انتظار 4.1))
- creators: معرفات المنشئين للزحف (متعددة مفصولة بـ ',')، صالحة فقط لـ ks، wb، وmp، حيث يدعم ks وmp إدخال 'homefeed' (يمثل الحصول على محتوى دفع النظام في كل مرة). يمكن أيضاً ترك هذا الحقل فارغاً، وفي هذه الحالة سيتم استخدام المصدر للبحث فقط

  *ملاحظة: استخدم رابط الصفحة الرئيسية للنسخة الويب المقابلة للمنصة، على سبيل المثال، إذا كان معرف ويبو هو https://m.weibo.cn/profile/2656274875، فإن المعرف هو 2656274875*

- url: الرابط المقابل لمصدر المعلومات، صالح فقط لأنواع rss وweb

### 3. عرض النتائج

- صفحة infos: تخزين المعلومات المفيدة المستخرجة في النهاية
- صفحة crawled_data: تخزين بيانات الزحف الأصلية
- صفحة ks_cache: تخزين بيانات ذاكرة التخزين المؤقت لكوايشو
- صفحة wb_cache: تخزين بيانات ذاكرة التخزين المؤقت لويبو

## 🌟 تثبيت النشر

**تثبيت النشر يتطلب ثلاث خطوات فقط!**

**يجب على مستخدمي Windows تحميل أداة git bash مسبقاً وتنفيذ الأوامر التالية في bash [رابط تحميل bash](https://git-scm.com/downloads/win)**

### 📋 تحميل كود المصدر وتثبيت uv و pocketbase

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
git clone https://github.com/TeamWiseFlow/wiseflow.git
```

ستكتمل عملية تثبيت uv من خلال الخطوات السابقة.

بعد ذلك، قم بزيارة [pocketbase docs](https://pocketbase.io/docs/) لتحميل برنامج pocketbase المناسب لنظام التشغيل الخاص بك وضعه في مجلد [.pb](./pb/)

يمكنك أيضاً استخدام install_pocketbase.sh (لنظامي MacOS/Linux) أو install_pocketbase.ps1 (لنظام Windows) للتثبيت.

### 📥 تكوين ملف .env بناءً على env_sample

في مجلد wiseflow (دليل جذر المشروع)، قم بإنشاء ملف .env بناءً على env_sample واملأ الإعدادات ذات الصلة.

الإصدار 4.x لا يتطلب من المستخدمين تقديم بيانات اعتماد حساب PocketBase في .env، ولا يحد من إصدار PocketBase. كما قمنا بإزالة إعداد Secondary Model مؤقتاً. لذلك، تحتاج فعلياً إلى أربعة معلمات فقط لإكمال التكوين:

- LLM_API_KEY="" # مفتاح خدمة LLM (أي مزود خدمة نموذج يقدم واجهة برمجة تطبيقات بتنسيق OpenAI مقبول، لا حاجة للإعداد عند استخدام ollama المثبت محلياً)
- LLM_API_BASE="https://api.siliconflow.com/v1" # عنوان واجهة خدمة LLM
- JINA_API_KEY="" # مفتاح خدمة محرك البحث (يوصى بـ Jina، حتى الاستخدام الشخصي يمكن التقديم بدون تسجيل)
- PRIMARY_MODEL="Qwen3-14B" # يوصى بـ Qwen3-14B أو نموذج تفكير مماثل
- VL_MODEL="Pro/Qwen/Qwen2.5-VL-7B-Instruct" # نموذج بصري، اختياري ولكن موصى به. يستخدم لتحليل صور الصفحات الضرورية (سيحدد البرنامج ما إذا كان التحليل ضرورياً بناءً على السياق، ولن يقوم باستخراج كل صورة)، الحد الأدنى Qwen2.5-VL-7B-Instruct كافٍ

### 🚀 دعنا نبدأ!

```bash
cd wiseflow
uv venv # فقط يحتاج إلى التنفيذ في المرة الأولى
source .venv/bin/activate  # Linux/macOS
# لنظام Windows:
# .venv\Scripts\activate
uv sync # فقط يحتاج إلى التنفيذ في المرة الأولى
python -m playwright install --with-deps chromium # فقط يحتاج إلى التنفيذ في المرة الأولى
chmod +x run.sh # فقط يحتاج إلى التنفيذ في المرة الأولى
./run.sh
```

✨ **بهذه البساطة!** سيكمل سكريبت البدء المهام التالية تلقائياً:
- ✅ التحقق من تكوين البيئة
- ✅ مزامنة تبعيات المشروع
- ✅ تفعيل البيئة الافتراضية
- ✅ بدء قاعدة بيانات PocketBase
- ✅ تشغيل تطبيق WiseFlow

سيقوم البرنامج أولاً بتنفيذ مهمة زحف لجميع المصادر المفعلة (المعينة كـ true)، ثم سينفذ بشكل دوري وفقاً للتردد المحدد بالساعات.

⚠️ **ملاحظة:** عند استخدام `Ctrl+C` لإنهاء العملية، قد لا تنتهي عملية PocketBase تلقائياً وقد تحتاج إلى إغلاقها يدوياً أو إعادة تشغيل الطرفية.

### 📝 التثبيت اليدوي (اختياري)

إذا كنت ترغب في التحكم يدوياً في كل خطوة، يمكنك اتباع الخطوات التالية:

#### 1. تنفيذ سكريبت install_pocketbase في الدليل الجذر

يجب على مستخدمي Linux/macOS تنفيذ:

```bash
chmod +x install_pocketbase.sh
./install_pocketbase.sh
```

**يجب على مستخدمي Windows تنفيذ:**
```powershell
.\install_pocketbase.ps1
```

#### 2. إنشاء وتفعيل البيئة الافتراضية

```bash
uv venv
source .venv/bin/activate  # Linux/macOS
# أو على Windows:
# .venv\Scripts\activate
```

##### 4.2 تثبيت التبعيات

```bash
uv sync
```

سيقوم هذا بتثبيت WiseFlow وجميع تبعياته، مما يضمن اتساق إصدارات التبعيات. يقرأ uv sync إعلانات تبعيات المشروع ويقوم بمزامنة البيئة الافتراضية.

ثم قم بتثبيت تبعيات المتصفح:

```bash
python -m playwright install --with-deps chromium
```

أخيراً، ابدأ الخدمة الرئيسية:

```bash
python core/run_task.py
# أو على Windows:
# python core\run_task.py
```

عندما تحتاج إلى استخدام واجهة مستخدم PocketBase، ابدأ خدمة PocketBase:

```bash
cd wiseflow/pb
./pocketbase serve
```

أو على Windows:

```powershell
cd wiseflow\pb
.\pocketbase.exe serve
```

### 🔧 تكوين متغيرات البيئة

سواء كنت تستخدم البداية السريعة أو التثبيت اليدوي، تحتاج إلى إنشاء ملف .env بناءً على env_sample:

#### 1. تكوين LLM

WiseFlow هو تطبيق أصلي لـ LLM. يرجى التأكد من توفير خدمة LLM مستقرة للبرنامج.

🌟 **لا يحد WiseFlow من مزود خدمة النموذج، طالما أن الخدمة متوافقة مع SDK الخاص بـ OpenAI، بما في ذلك ollama المثبت محلياً، وXinference، وغيرها من الخدمات**

##### التوصية 1: استخدام خدمة MaaS من SiliconFlow

يوفر SiliconFlow خدمات MaaS عبر الإنترنت لمعظم النماذج مفتوحة المصدر الرئيسية. بفضل تقنية الاستدلال المتسارع الخاصة بهم، تتمتع خدمتهم بمزايا في كل من السرعة والسعر. عند استخدام خدمة SiliconFlow، يمكن أن يكون تكوين .env كالتالي:

```
LLM_API_KEY=Your_API_KEY
LLM_API_BASE="https://api.siliconflow.com/v1"
PRIMARY_MODEL="Qwen3-14B"
VL_MODEL="Pro/Qwen/Qwen2.5-VL-7B-Instruct"
CONCURRENT_NUMBER=8
```

😄 إذا كنت ترغب، يمكنك استخدام [رابط دعوة SiliconFlow](https://cloud.siliconflow.com/i/WNLYbBpi)، حتى أتمكن من الحصول على المزيد من مكافآت الرموز 🌹

##### التوصية 2: استخدام خدمات النماذج التجارية مغلقة المصدر الخارجية الموكلة من AiHubMix مثل OpenAI وClaude وGemini

إذا كانت مصادر المعلومات الخاصة بك في الغالب صفحات غير صينية ولا تتطلب أن تكون المعلومات المستخرجة باللغة الصينية، فإن النماذج التجارية مغلقة المصدر الخارجية مثل OpenAI وClaude وGemini موصى بها أكثر. يمكنك تجربة الوكيل الخارجي **AiHubMix**، الذي يدعم الاتصال المباشر في بيئة الشبكة الصينية، والدفع المريح عبر Alipay، وإزالة مخاطر حظر الحساب.
عند استخدام نماذج AiHubMix، يمكن أن يكون تكوين .env كالتالي:

```
LLM_API_KEY=Your_API_KEY
LLM_API_BASE="https://aihubmix.com/v1" # للتفاصيل، راجع https://doc.aihubmix.com/
PRIMARY_MODEL="gpt-4o-mini"
VL_MODEL="gpt-4o"
CONCURRENT_NUMBER=8
```

😄 مرحباً بك للتسجيل باستخدام [رابط دعوة AiHubMix](https://aihubmix.com?aff=Gp54) 🌹

##### نشر خدمة LLM المحلية

باستخدام Xinference كمثال، يمكن أن يكون تكوين .env كالتالي:

```
# LLM_API_KEY='' غير مطلوب للخدمة المحلية، يرجى التعليق أو الحذف
LLM_API_BASE='http://127.0.0.1:9997' # 'http://127.0.0.1:11434/v1' لـ ollama
PRIMARY_MODEL=معرف النموذج الذي تم بدؤه
VL_MODEL=معرف النموذج الذي تم بدؤه
CONCURRENT_NUMBER=1 # حدد بناءً على موارد الأجهزة الفعلية
```

#### 3. إعداد JINA_API_KEY (لخدمة محرك البحث)

احصل عليه من https://jina.ai/، متاح حالياً بدون تسجيل. (يرجى الشحن للاستخدام المتزامن العالي أو التجاري)

```
JINA_API_KEY=Your_API_KEY
```

#### 4. إعدادات اختيارية أخرى

الإعدادات التالية اختيارية:
- #VERBOSE="true" 

  ما إذا كان سيتم تمكين وضع المراقبة، إذا تم التمكين، سيتم تسجيل معلومات التصحيح في ملف المسجل (الافتراضي هو الإخراج في وحدة التحكم فقط)

- #CONCURRENT_NUMBER=8 

  يستخدم للتحكم في عدد طلبات LLM المتزامنة، الافتراضي هو 1 إذا لم يتم التعيين (يرجى التأكد من أن مزود LLM يدعم التزامن المحدد قبل التمكين، استخدم بحذر للنماذج الكبيرة المحلية ما لم تكن واثقاً من أساس الأجهزة الخاصة بك)

## 🐳 نشر Docker

يرجى انتظار حل نشر Docker للإصدار 4.x، ونحن أيضاً نرحب بمساهمات PR من المطورين المهتمين~

## 🌹 الخدمات المدفوعة

البرمجيات مفتوحة المصدر ليست سهلة ☺️ كتابة الوثائق والاستشارات وQ&A تستغرق المزيد من الوقت. إذا كنت على استعداد لتقديم الدعم، سنقدم خدمات أفضل جودة~

- فيديو تعليمي مفصل + 3 ردود على استفسارات عبر البريد الإلكتروني + الانضمام إلى مجموعة مستخدمي WeChat المدفوعة: ¥36.88

طريقة الدفع: امسح رمز الاستجابة السريعة أدناه، ثم أضف WeChat: bigbrother666sh، وقدم لقطة شاشة للدفع.

(سيتم قبول طلبات الصداقة في غضون 8 ساعات. يمكنك أيضًا الاتصال بنا عبر البريد الإلكتروني على 35252986@qq.com)

<img src="alipay.png" alt="رمز QR للدفع عبر Alipay" width="300">      <img src="weixinpay.jpg" alt="رمز QR للدفع عبر WeChat Pay" width="300"> 